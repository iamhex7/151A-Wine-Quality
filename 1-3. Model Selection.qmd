---
title: Model Selection
format: typst
execute:
  warning: false
  message: false
---
### Preparation & Transformation
```{r}
# prep
library(tidyverse)
library(ggplot2)
library(tidyr)
library(corrplot)
library(broom)
library(purrr)

wine <- read_csv("data/wine.csv")
wine <- wine |>
  mutate(
    type = factor(
      type,
      levels = c(0, 1),
      labels = c("red", "white")
    )
  )
```
```{r}
wine_tf <- data.frame(
  # response
  quality = wine$quality,
  type = wine$type,
  
  # transformed predictors
  residual_sugar_t        = log(wine$residual_sugar + 0.1),
  total_sulfur_dioxide_t  = log(wine$total_sulfur_dioxide + 1),
  free_sulfur_dioxide_t   = log(wine$free_sulfur_dioxide + 1),
  chlorides_t             = log(wine$chlorides),
  volatile_acidity_t      = log(wine$volatile_acidity),
  sulphates_t             = log(wine$sulphates),
  citric_acid_t           = log(wine$citric_acid + 0.1),
  
  # raw predictors kept as-is
  alcohol          = wine$alcohol,
  fixed_acidity    = wine$fixed_acidity,
  pH               = wine$pH,
  density          = wine$density
)

```

## A
baseline / main effects / no interactions
```{r}
mA <- lm(
  quality ~ alcohol + residual_sugar_t + volatile_acidity_t +
    chlorides_t + sulphates_t + citric_acid_t +
    total_sulfur_dioxide_t + fixed_acidity + pH + type,
  data = wine_tf
)
```

## B
strong interactions:
- volatile_acidity Ã— type
- chlorides Ã— type
- residual_sugar Ã— type
```{r}
mB <- lm(
  quality ~ alcohol +
    residual_sugar_t * type +
    volatile_acidity_t * type +
    chlorides_t * type +
    total_sulfur_dioxide_t +
    fixed_acidity + pH,
  data = wine_tf
)
```

## C
strong + moderate interactions:
- total_sulfur_dioxide Ã— type
- residual_sugar Ã— type
- volatile_acidity Ã— type
- chlorides Ã— type

```{r}
mC <- lm(
  quality ~ alcohol +
    residual_sugar_t * type +
    volatile_acidity_t * type +
    chlorides_t * type +
    total_sulfur_dioxide_t * type +
    fixed_acidity + pH,
  data = wine_tf
)

```

## D
Strong + moderate + weak
```{r}
mD <- lm(
  quality ~ alcohol +
    residual_sugar_t * type +
    volatile_acidity_t * type +
    chlorides_t * type +
    total_sulfur_dioxide_t * type +
    citric_acid_t * type +
    sulphates_t * type +
    fixed_acidity + pH,
  data = wine_tf
)
```

## E
Replace SOâ‚‚ variable to test collinearity sensitivity

```{r}
mE <- lm(
  quality ~ alcohol +
    residual_sugar_t * type +
    volatile_acidity_t * type +
    chlorides_t * type +
    free_sulfur_dioxide_t +    # æ›¿ä»£ total_SOâ‚‚
    fixed_acidity + pH,
  data = wine_tf
)

```

## F
Minimal interpretable interaction model(æœ€è§£é‡ŠåŠ›å¼ºã€ç§‘å­¦æ„ä¹‰æœ€æ˜Žç¡®çš„äº¤äº’é¡¹)ï¼š
- residual sugarï¼ˆç™½é…’æ˜¾è‘—æ›´ç”œâ†’ä¸åŒ slopeï¼‰
- volatile acidityï¼ˆçº¢é…’å¯¹ VA æ•æ„Ÿåº¦æ›´é«˜ï¼‰

```{r}
mF <- lm(
  quality ~ alcohol +
    volatile_acidity_t * type +
    residual_sugar_t * type +
    fixed_acidity + pH,
  data = wine_tf
)
```

## G
Additive nonlinear expansion model

```{r}
mG <- lm(
  quality ~ alcohol + I(alcohol^2) +
    volatile_acidity_t + I(volatile_acidity_t^2) +
    residual_sugar_t + I(residual_sugar_t^2) +
    total_sulfur_dioxide_t +
    type,
  data = wine_tf
)
```



```{r}
models <- list(mA = mA, mB = mB, mC = mC, mD = mD, mE = mE, mF = mF, mG = mG)
model_summaries <- map_df(
  models,
  ~ glance(.x),
  .id = "model"
)

model_summaries
```

::: note
Model Dï¼ˆåŒ…å« strong + moderate interactionsï¼‰æ˜¯ç›®å‰è¡¨çŽ°æœ€å¥½çš„æ¨¡åž‹ï¼ŒAIC æœ€ä½Žã€BIC ç¬¬äºŒä½Žã€sigma æœ€å°ï¼Œè¯´æ˜Žå®ƒåœ¨æ‹Ÿåˆè´¨é‡ä¸Žå¤æ‚åº¦ä¹‹é—´å–å¾—äº†æœ€ä½³å¹³è¡¡ã€‚
:::


**ä»¥ä¸‹å†…å®¹ä»…ä¾›é˜…è¯»ï¼Œä¸è¦ç›´æŽ¥ç”¨â—ï¸â—ï¸**

**ðŸ”¹English Versionï¼ˆfor reportï¼‰**

Model D represents a hierarchical interaction model that incorporates both strong and moderate type-by-predictor interactions identified during the EDA stage. By allowing the effects of residual sugar, volatile acidity, chlorides, and total sulfur dioxide to vary between red and white wines, Model D captures meaningful structural differences in how chemical attributes influence sensory-perceived quality. Empirically, Model D achieves the best overall balance between model fit and complexity, with the lowest AIC, highest adjusted RÂ², and smallest residual standard error among all candidate models. These results suggest that interactions between wine type and key chemical factors are essential for explaining variability in quality ratings, making Model D the strongest explanatory model for our research question.

**ðŸ”¹ä¸­æ–‡ç‰ˆæœ¬ï¼ˆç”¨äºŽæŠ¥å‘Šè§£é‡Šï¼‰**

Model D æ˜¯ä¸€ä¸ªåˆ†å±‚äº¤äº’æ¨¡åž‹ï¼Œçº³å…¥äº†åœ¨ EDA é˜¶æ®µç¡®è®¤çš„å¼ºäº¤äº’ä¸Žä¸­ç­‰äº¤äº’é¡¹ã€‚é€šè¿‡å…è®¸ residual sugarã€volatile acidityã€chlorides ä¸Ž total sulfur dioxide å¯¹ wine quality çš„å½±å“åœ¨çº¢é…’ä¸Žç™½é…’ä¹‹é—´å‘ç”Ÿå˜åŒ–ï¼ŒModel D èƒ½å¤Ÿæ•æ‰â€œåŒ–å­¦å±žæ€§å¦‚ä½•ä»¥ä¸åŒæ–¹å¼å½±å“ä¸åŒç±»åž‹è‘¡è„é…’çš„æ„Ÿå®˜è¯„åˆ†â€è¿™ä¸€æ ¸å¿ƒç»“æž„æ€§å·®å¼‚ã€‚ä»Žç»éªŒç»“æžœæ¥çœ‹ï¼ŒModel D åœ¨æ‰€æœ‰å€™é€‰æ¨¡åž‹ä¸­å‘ˆçŽ°å‡ºæ‹Ÿåˆåº¦ä¸Žå¤æ‚åº¦ä¹‹é—´çš„æœ€ä½³å¹³è¡¡â€”â€”å…·æœ‰æœ€ä½Žçš„ AICã€æœ€é«˜çš„ adjusted RÂ²ã€ä»¥åŠæœ€å°çš„æ®‹å·®æ ‡å‡†å·®ã€‚è¿™è¡¨æ˜Ž wine type ä¸Žå…³é”®åŒ–å­¦å› å­ä¹‹é—´çš„äº¤äº’æ•ˆåº”å¯¹äºŽè§£é‡Šè´¨é‡è¯„åˆ†çš„å˜å¼‚è‡³å…³é‡è¦ï¼Œä½¿ Model D æˆä¸ºå›žç­”æœ¬ç ”ç©¶é—®é¢˜çš„æœ€å…·è§£é‡ŠåŠ›çš„æ¨¡åž‹ã€‚